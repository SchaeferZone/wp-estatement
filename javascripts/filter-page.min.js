function frequency(e){var t=[],n=[],r;e.sort();for(var i=0;i<e.length;i++){if(e[i]!==r){t.push(e[i]);n.push(1)}else n[n.length-1]++;r=e[i]}return[t,n]}function filter_properties_ajax(e){var t=jQuery("#filterPageSearch");serialized=t.serializeArray();serializedString=JSON.stringify(serialized);if(typeof e=="undefined"||e=="")e=1;jQuery.ajax({url:estAjax.ajaxurl,type:"post",beforeSend:function(){jQuery("#filter").prepend('<div id="filterLoad"></div>')},data:{page_id:jQuery("#filter").attr("data-page-id"),args:jQuery("#fiterArgs").html(),details:jQuery("#fiterDetails").html(),search:jQuery("#fiterSearch").html(),options:jQuery("#fiterOptions").html(),form:serializedString,page:e,action:"est_get_filter_content"},success:function(e){jQuery("#filter").html(e)}});return!1}jQuery(document).ready(function(e){function n(){clearTimeout(t);t=setTimeout("filter_properties_ajax()",500)}function i(){serialized=r.serializeArray();options=[];e.each(serialized,function(n,r){r=e(this);r=r[0];value=r.value;filter_type=e('*[name="'+r.name+'"]:first').parents(".checkboxes").data("type");if(typeof r.name=="undefined"||r.name==null)r.name="";value!=""&&value!=null&&typeof value!="undefined"&&(value=value.replace(" ","-"));if(r.name.substr(-2)=="[]"){t=r.name.substr(0,r.name.length-2);if(t in options)options[t].values.push(value);else{options[t]=[];options[t].type="array",options[t].values=[];options[t].values.push(value)}options[t].filter_type=filter_type}else if(r.name.substr(-5)=="[min]"){t=r.name.substr(0,r.name.length-5);if(!(t in options)){options[t]=[];options[t].type="range"}options[t].filter_type=filter_type;options[t].min=value}else if(r.name.substr(-5)=="[max]"){t=r.name.substr(0,r.name.length-5);if(!(t in options)){options[t]=[];options[t].type="range"}options[t].filter_type=filter_type;options[t].max=value}else{t=r.name;if(!(t in options)){options[t]=[];options[t].type="value";options[t].value=value;options[t].filter_type=filter_type}}});property_ids=[];o=0;for(var t in options){var n=options[t];if(n.type==="value"){if(n.value=="")properties=e(".property");else{classname=".property.filter_"+t+"-"+n.value;properties=e(classname)}property_ids[o]=[];e.each(properties,function(){property_ids[o].push(e(this).attr("data-id"))})}else if(n.type==="array"){i=[];if(n.filter_type=="or")e.each(n.values,function(n,r){classname=".property.filter_"+t+"-"+r;properties=e(classname);e.each(properties,function(){i.push(e(this).attr("data-id"))})});else{classname="";e.each(n.values,function(e,n){classname=classname+".property.filter_"+t+"-"+n});properties=e(classname);e.each(properties,function(){i.push(e(this).attr("data-id"))})}var i=i.filter(function(e,t,n){return t==n.indexOf(e)});property_ids[o]=i}else if(n.type==="range"){i=[];min=parseFloat(n.min);max=parseFloat(n.max);e.each(e("#propertyFilter .property"),function(){value=parseFloat(e(this).attr("data-"+t));value>=min&&value<=max&&i.push(e(this).attr("data-id"))});property_ids[o]=i}o++}var s=0;e.each(property_ids,function(){this.length==0&&(s=1)});properties=[];freq=0;e.each(property_ids,function(e,t){t!=""&&t!=null&&typeof t!="undefined"&&freq++;properties=properties.concat(t)});properties=frequency(properties);properties_to_show=[];for(var o in properties[1])properties[1][o]==freq&&properties_to_show.push(".post-"+properties[0][o]);properties_to_show=properties_to_show.join(",");if(properties_to_show==""||properties_to_show==null||typeof properties_to_show=="undefined"||s==1){properties_to_show=".noneatall";e("#filterNoResults").fadeIn()}else e("#filterNoResults").fadeOut();e("#propertyFilter").isotope({filter:properties_to_show})}var t="",r=e("#filterPageSearch");e("#propertyFilter").isotope({itemSelector:".property",layoutMode:"straightDown"});e.each(r.find(".range"),function(){var t=e(this).attr("data-min"),r=e(this).attr("data-max"),s=e(this).attr("id"),o=e(this).attr("data-name"),u=e('.range-values[data-id="'+s+'"]'),a=e(this).attr("data-value_min"),f=e(this).attr("data-value_max");e(this).noUiSlider({range:[t,r],start:[t,r],step:r-t<100?1:20,slide:function(){var t=e(this).val();u.find(".min .value").html(number_format(parseFloat(t[0]),0,estAjax.decimal_separator,estAjax.thousand_separator));u.find(".max .value").html(number_format(parseFloat(t[1]),0,estAjax.decimal_separator,estAjax.thousand_separator));e("#filterPageSearch").attr("data-type")=="paginate"?n():i()},serialization:{to:[o+"[min]",o+"[max]"],resolution:1}});if(a!=""&&f!=""){e(this).val([a,f]);u.find(".min .value").html(number_format(parseFloat(a),0,estAjax.decimal_separator,estAjax.thousand_separator));u.find(".max .value").html(number_format(parseFloat(f),0,estAjax.decimal_separator,estAjax.thousand_separator))}});r.find("select").not('#filterPageSearch[data-type="paginate"] select').on("change",function(){i()});r.find('input[type="text"]').not('#filterPageSearch[data-type="paginate"] input[type="text"]').on("keyup",function(){i()});e(document).on("change",'input[type="checkbox"]',function(){parent=e(this).parents('#filterPageSearch[data-type="paginate"]');parent.length==0&&i()});e(document).on("change",'#filterPageSearch[data-type="paginate"] select',function(){filter_properties_ajax()});r.find('#filterPageSearch[data-type="paginate"] input[type="text"]').on("keyup",function(){filter_properties_ajax()});e(document).on("change",'input[type="checkbox"]',function(){parent=e(this).parents('#filterPageSearch[data-type="paginate"]');parent.length==1&&filter_properties_ajax()});e(document).on("click","#filter .pagination a",function(){current=parseInt(e("#filter .pagination .current").html());e(this).hasClass("next")?next=current+1:e(this).hasClass("next")?next=current-1:next=parseInt(e(this).html());filter_properties_ajax(next);return!1})});